<button class="js-next-transact" data-id="<%= @next_id %>">Next Trade</button>
<div class="col-sm-8">
<table class="table">
  <thead>
    <tr>
    	<% if @transact.pending %>
    		<th colspan="2">Pending Trade</th>
    	<% else %>
    		<th colspan="2">Completed Trade</th>
    	<% end %>
    </tr>
  </thead>
  <tbody>
  	<tr>
  		<td>Bond</td>
  		<td id="description"><%= @transact.bond.print_description %></td>
  	</tr>
  	<tr>
  		<td>Type</td>
  		<td id="type">
  			<% if @transact.we_buy == true %>
				Buy
			<% else %>
				Sell
			<% end %>
		</td>
  	</tr>
  	<tr>
  		<td>Size (m)</td>
  		<td id="size"><%= @transact.size %></td>
  	</tr>

  	<tr>
  		<td>Price</td>
  		<td id="price"><%= number_to_currency(@transact.price) %></td>
  	</tr>
  	<tr>
  		<td>Trader</td>
  		<td id="trader"><%= @transact.trader.name %></td>
  	</tr>
  	<tr>
  		<td>Client</td>
  		<td id="client"><%= @transact.client.name %></td>
  	</tr>
  	<% if @transact.salespeople.any? %>
  		<tr>
  			<td>Salespeople</td>
  			<td id= "salespeople">
  				<%= @transact.salespeople.map{|sp| sp.name}.join(", ") %>
			</td>
	  	</tr>
  	<% end %>
  	<tr>
  		<td>Trade Time</td>
  		<td id="trade_time"><%= @transact.trade_time.strftime('%m-%d-%Y %H:%M:%S') %></td>
  	</tr>
  	<tr>
  		<td>Created at</td>
  		<td id="created_at"><%= @transact.created_at.strftime('%m-%d-%Y %H:%M:%S') %></td>
  	</tr>
  	<tr>
  		<td>Last Updated</td>
  		<td id="updated_at"><%= @transact.updated_at.strftime('%m-%d-%Y %H:%M:%S') %></td>
  	</tr>
  </tbody>
</table>


<% if user_is_trader %>
	<%= link_to "Edit Trade Details", edit_transact_path(@transact), id: "edit"%>
	<% if @transact.pending == true %>
		<%= link_to "Confirm Trade", confirm_transact_path(@transact), method: :patch, id: "confirm" %>
	<% end %>
	<%= link_to "Cancel Trade", transact_path(@transact), method: :delete, id: "cancel" %>
<% end %>
</div>

<script type="text/javascript">
  $(".js-next-transact").on("click", function() {
     var nextId = parseInt($(".js-next-transact").attr("data-id"));
     $.get("/transacts/" + nextId + ".json", function(data) {
        var sp_names = []
        var salespeople = data.salespeople
        for (i in salespeople) {
          sp_names.push(salespeople[i]["name"])
        }
        $("#description").text(data["bond"]["description"])
        $("#price").text(data["price"])
        $("#type").text(data["trade_type"])
        $("#size").text(data["size"])
        $("#trader").text(data["trader"])
        $("#client").text(data["client"])
        $("#salespeople").text(sp_names.join(', '))
        $("#trade_time").text(data["f_trade_time"])
        $("#updated_at").text(data["f_updated_at"])
        $("#created_at").text(data["f_created_at"])
        $("#edit").attr("href", `/transacts/${data["id"]}/edit`)
        $("#cancel").attr("href", `/transacts/${data["id"]}/cancel`)
        $("#confirm").attr("href", `/transacts/${data["id"]}/confirm`)

        $(".js-next-transact").attr("data-id", data["next_id"])
      })
    })
</script>

<script id="duplicate-transact-template" type="text/x-handlebars-template">
  <form class="new_transact" id="new_transact" action="/transacts" accept-charset="UTF-8" method="post">
    <input name="utf8" type="hidden" value="âœ“">
    <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
    <div class="row">
      <div class="col-sm-3">
        <div class="form-group">
          <label for="transact_Buy">Buy</label>
          <input type="radio" value="true" name="transact[we_buy]" id="transact_we_buy_true" {{checkType trade_type "Buy"}}>
          <label for="transact_Sell">Sell</label>
          <input type="radio" value="false" name="transact[we_buy]" id="transact_we_buy_false" {{checkType trade_type "Buy"}}>
        </div>

        <div class="form-group">
          <label for="transact_Size (M)">Size (m)</label><br> 
          <input class="form-control" type="number" name="transact[size]" id="transact_size" value: {{size}}>
        </div>
           <div class="form-group">
            <label for="transact_bond_id">Bond</label><br>
            <select class="form-control" name="transact[bond_id]" id="transact_bond_id"><option value="7">BEEFBZ 6.5% 2026</option>
            </select>
          </div>
         <div class="form-group">
          <label for="transact_price">Price</label><br>
          <input class="form-control" step="0.001" type="number" name="transact[price]" id="transact_price">
        </div>
      </div>
      <div class="col-sm-3">   
        <br><br>
         <div class="form-group" style="margin-left: 25px">
          <label for="transact_trader_id">Trader</label><br>
          <select style="width:150px; height:30px" name="transact[trader_id]" id="transact_trader_id">
            <option value=""></option>
            <option value="9">Brendan</option>
            </select>
         </div>
         <br><br>
         <div class="form-group" style="margin-left: 25px">
            <label for="transact_client_id">Client</label><br>

            <select style="width:150px; height:30px" name="transact[client_id]" id="transact_client_id">
              <option value=""></option>
              <option value="1">BlackRock</option>
              </select>
         </div>
      </div>
    <div class="col-sm-3"> 
      <br><br>
       <div class="form-group">
        <label for="transact_Salespeople">Salespeople</label><br>
        <input name="transact[salesperson_ids][]" type="hidden" value=""><select multiple="multiple" style="width:150px; height:100px" name="transact[salesperson_ids][]" id="transact_salesperson_ids">
          <option value=""></option>
          <option value="7">Brendan O'Dea</option>
          </select>
      </div>
       <div class="form-group">
        <label for="transact_Time of trade">Time of trade</label><br>
        <input value="2018-05-30T13:02" type="datetime-local" name="transact[trade_time]" id="transact_trade_time">
      </div>
    </div>
    </div>
      <br>
        <input value="false" type="hidden" name="transact[pending]" id="transact_pending">
      <div class="actions">
        <input type="submit" name="commit" value="Book Trade" class="btn btn-primary" data-disable-with="Create Transact">
      </div>
</form>
</script>

<script type="text/javascript">
  function handlebarsSetup() {
    Handlebars.registerHelper('checkType', function(trade_type, button_type) {
      if (trade_type == button_type) {
        return "checked";
      } else {
        return ""
      }
    })
  }
</script>

